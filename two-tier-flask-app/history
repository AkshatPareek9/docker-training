# Commands for docker learning
cd docker-training/two-tier-flask-app/
cat app.py

## Build the image using docker file
vim Dockerfile

## Attach a default bridge network between both the containers (flask app and mysql)
docker network ls
docker network create two-tier -d bridge
docker network  ls
docker images
docker login
docker pull mysql
docker images | grep mysql
docker run -d --name mysql --network two-tier -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=devops mysql
docker build -t flask-app .
docker run -d --name flask-app --network two-tier -p 5000:5000 -e MYSQL_HOST="mysql" -e MYSQL_USER="root" -e MYSQL_PASSWORD="root" -e MYSQL_DB="devops" flask-app:latest
docker ps | grep flask-app
docker ps | grep mysql
docker logs flask-app
docket logs mysql
docker exec -it flask-app bash
docker exec -it mysql bash
docker network inspect two-tier
docker stop flask-app && docker rm flask-app
docker run -d --name flask-app --network two-tier -p 5000:5000 -e MYSQL_HOST=mysql -e MYSQL_USER=root -e MYSQL_PASSWORD=root -e MYSQL_DB=devops flask-app
docker stop mysql && docker rm mysql
docker run -d --name mysql --network two-tier -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=devops mysql
docker stop flask-app && docker rm flask-app
docker run -d --name flask-app --network two-tier  -p 5000:5000 -e MYSQL_HOST=mysql -e MYSQL_USER=root -e MYSQL_PASSWORD=root -e MYSQL_DB=devops flask-app

## use volume to persist the data
docker volume ls
docker volume create mysql-data
docker volume ls
docker stop mysql && docker rm mysql
docker run -d --name mysql --network two-tier -v mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=devops mysql
docker stop flask-app && docker rm flask-app
docker run -d --name flask-app --network two-tier  -p 5000:5000 -e MYSQL_HOST=mysql -e MYSQL_USER=root -e MYSQL_PASSWORD=root -e MYSQL_DB=devops flask-app
docker ps -a
docker stop flask-app && docker rm flask-app
docker run -d --name flask-app --network two-tier  -p 5000:5000 -e MYSQL_HOST=mysql -e MYSQL_USER=root -e MYSQL_PASSWORD=root -e MYSQL_DB=devops flask-app
docker stop mysql && docker rm mysql
docker run -d --name mysql --network two-tier -v mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=devops mysql
docker volume inspect mysqldata

## use custom volume path
docker stop mysql && docker rm mysql
docker stop flask-app && docker rm flask-app
docker run -d --name mysql --network two-tier -v ./mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=devops mysql
docker run -d --name flask-app --network two-tier  -p 5000:5000 -e MYSQL_HOST=mysql -e MYSQL_USER=root -e MYSQL_PASSWORD=root -e MYSQL_DB=devops flask-app

## Build the image using multi stage Dockerfile
docker build -t flask-app-mini .
docker stop mysql && docker rm mysql
docker stop flask-app && docker rm flask-app
docker run -d --name mysql --network two-tier -v ./mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=root -e MYSQL_DATABASE=devops mysql
docker run -d --name flask-app --network two-tier  -p 5000:5000 -e MYSQL_HOST=mysql -e MYSQL_USER=root -e MYSQL_PASSWORD=root -e MYSQL_DB=devops flask-app

## Build the application using docker-compose
docker compose up
docker compose up -d
docker compose down
